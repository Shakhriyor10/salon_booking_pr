{% extends 'base3.html' %}
{% load static %}

{% block content %}
<style>
  .appointments-dashboard {
    color: #1c1c1c;
  }

  .appointments-hero {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.85), rgba(233, 227, 255, 0.95)),
                url('{% static "img/hero-texture.svg" %}') center/cover;
    border-radius: 28px;
    padding: 48px clamp(24px, 6vw, 72px);
    box-shadow: 0 32px 60px rgba(31, 41, 55, 0.15);
    position: relative;
    overflow: hidden;
  }

  .appointments-hero::after {
    content: "";
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at top right, rgba(132, 94, 247, 0.2), transparent 45%),
                radial-gradient(circle at bottom left, rgba(255, 148, 114, 0.25), transparent 50%);
    pointer-events: none;
  }

  .appointments-hero h1 {
    font-weight: 700;
    font-size: clamp(28px, 4vw, 42px);
    color: #1a1a1a;
  }

  .appointments-hero p {
    max-width: 520px;
    font-size: 1.05rem;
    color: #5a5a5a;
  }

  .appointments-hero .cta-btn {
    background: linear-gradient(135deg, #845ef7, #5f3dc4);
    color: #fff;
    border-radius: 999px;
    padding: 12px 28px;
    font-weight: 600;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 10px;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .appointments-hero .cta-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 18px 35px rgba(95, 61, 196, 0.35);
    color: #fff;
  }

  .summary-grid {
    margin-top: 36px;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 18px;
  }

  .summary-card {
    background: #fff;
    border-radius: 20px;
    padding: 22px 24px;
    box-shadow: 0 18px 40px rgba(17, 24, 39, 0.08);
    position: relative;
    overflow: hidden;
  }

  .summary-card .badge-icon {
    width: 44px;
    height: 44px;
    border-radius: 14px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    margin-bottom: 16px;
  }

  .summary-card h3 {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 6px;
  }

  .summary-card p {
    margin: 0;
    color: #7d7d7d;
    font-size: 0.95rem;
  }

  .summary-card.total .badge-icon {
    background: rgba(132, 94, 247, 0.15);
    color: #5f3dc4;
  }

  .summary-card.pending .badge-icon {
    background: rgba(255, 214, 102, 0.22);
    color: #c9980a;
  }

  .summary-card.confirmed .badge-icon {
    background: rgba(123, 211, 234, 0.24);
    color: #0c8599;
  }

  .summary-card.done .badge-icon {
    background: rgba(104, 226, 140, 0.24);
    color: #2b8a3e;
  }

  .summary-card.canceled .badge-icon {
    background: rgba(252, 161, 158, 0.24);
    color: #c92a2a;
  }

  .timeline {
    margin-top: 48px;
    position: relative;
    padding-left: 18px;
  }

  .timeline::before {
    content: "";
    position: absolute;
    left: 12px;
    top: 0;
    bottom: 0;
    width: 2px;
    background: linear-gradient(180deg, rgba(132, 94, 247, 0.4), rgba(95, 61, 196, 0));
  }

  .appointment-card {
    margin-bottom: 28px;
    margin-left: 22px;
    background: #fff;
    border-radius: 22px;
    padding: 24px 26px;
    box-shadow: 0 22px 45px rgba(15, 23, 42, 0.1);
    border: 1px solid rgba(132, 94, 247, 0.08);
    position: relative;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .appointment-card::before {
    content: "";
    position: absolute;
    left: -34px;
    top: 32px;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: #fff;
    border: 4px solid #845ef7;
    box-shadow: 0 0 0 6px rgba(132, 94, 247, 0.12);
  }

  .appointment-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 28px 55px rgba(15, 23, 42, 0.15);
  }

  .appointment-header {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 18px;
    margin-bottom: 16px;
  }

  .appointment-header .salon-name {
    font-weight: 700;
    font-size: 1.2rem;
    color: #1f1f1f;
  }

  .appointment-header .status-chip {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    border-radius: 999px;
    padding: 8px 16px;
    font-weight: 600;
    font-size: 0.9rem;
  }

  .status-pending {
    background: rgba(255, 214, 102, 0.18);
    color: #b88402;
  }

  .status-confirmed {
    background: rgba(123, 211, 234, 0.18);
    color: #0b7285;
  }

  .status-done {
    background: rgba(104, 226, 140, 0.18);
    color: #2b8a3e;
  }

  .status-canceled {
    background: rgba(252, 161, 158, 0.18);
    color: #c92a2a;
  }

  .services-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
  }

  .services-list li {
    background: rgba(132, 94, 247, 0.08);
    color: #5235a5;
    padding: 6px 14px;
    border-radius: 12px;
    font-size: 0.92rem;
  }

  .appointment-footer {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    justify-content: space-between;
    align-items: center;
    margin-top: 22px;
  }

  .appointment-footer .time-block {
    display: flex;
    align-items: center;
    gap: 12px;
    color: #444;
    font-weight: 600;
  }

  .appointment-footer .actions button {
    border-radius: 999px;
    padding: 8px 20px;
  }

  .empty-state {
    background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(240, 240, 255, 0.9));
    border: 1px dashed rgba(132, 94, 247, 0.4);
    border-radius: 24px;
    padding: 56px 36px;
    text-align: center;
    color: #4c4c4c;
    box-shadow: inset 0 0 0 1px rgba(132, 94, 247, 0.08);
  }

  .empty-state h3 {
    font-weight: 700;
    margin-bottom: 12px;
    color: #1f1f1f;
  }

  .wellbeing-box {
    margin-top: 48px;
    background: linear-gradient(135deg, rgba(94, 234, 212, 0.16), rgba(34, 197, 94, 0.12));
    border-radius: 26px;
    padding: 32px;
    display: grid;
    grid-template-columns: 1.2fr 1fr;
    gap: 28px;
    align-items: center;
  }

  .wellbeing-box ul {
    margin: 0;
    padding-left: 18px;
    color: #2b8a3e;
    font-size: 0.98rem;
  }

  .wellbeing-box strong {
    color: #1f6f43;
  }

  @media (max-width: 992px) {
    .appointments-hero {
      padding: 38px 28px;
    }
    .appointment-card {
      margin-left: 14px;
    }
    .appointment-card::before {
      left: -26px;
    }
  }

  @media (max-width: 768px) {
    .appointments-hero {
      text-align: center;
    }
    .appointments-hero p {
      margin: 0 auto;
    }
    .appointments-hero .cta-btn {
      justify-content: center;
    }
    .timeline {
      padding-left: 0;
    }
    .timeline::before {
      left: -9999px;
    }
    .appointment-card {
      margin-left: 0;
    }
    .appointment-card::before {
      display: none;
    }
    .wellbeing-box {
      grid-template-columns: 1fr;
      text-align: center;
    }
    .wellbeing-box ul {
      text-align: left;
    }
  }
</style>

<div class="appointments-dashboard">
  <div class="appointments-hero">
    <div class="position-relative" style="z-index: 1;">
      <span class="badge rounded-pill bg-dark-subtle text-dark fw-semibold mb-3 px-3 py-2">–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å</span>
      <h1>‚ú® –ú–æ–∏ –∑–∞–ø–∏—Å–∏</h1>
      <p>–°–ª–µ–¥–∏—Ç–µ –∑–∞ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏–º–∏ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞–º–∏, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏ –∏ –ø–ª–∞–Ω–∏—Ä—É–π—Ç–µ —Å–≤–æ–π –∏–¥–µ–∞–ª—å–Ω—ã–π –±—å—é—Ç–∏-–≥—Ä–∞—Ñ–∏–∫.</p>
      <a href="{% url 'home' %}" class="cta-btn">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –µ—â–µ —Ä–∞–∑ <i class="bi bi-arrow-right-short fs-4"></i></a>
    </div>
  </div>

  {% if appointments %}
  {% regroup appointments by status as status_groups %}
  <div class="summary-grid">
    <div class="summary-card total">
      <div class="badge-icon"><i class="bi bi-calendar-heart"></i></div>
      <h3>{{ appointments|length }}</h3>
      <p>–í—Å–µ–≥–æ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ</p>
    </div>

    {% for group in status_groups %}
    <div class="summary-card {% if group.grouper == 'P' %}pending{% elif group.grouper == 'C' %}confirmed{% elif group.grouper == 'D' %}done{% elif group.grouper == 'canceled' %}canceled{% endif %}">
      <div class="badge-icon">
        {% if group.grouper == 'P' %}
          <i class="bi bi-hourglass-split"></i>
        {% elif group.grouper == 'C' %}
          <i class="bi bi-check2-circle"></i>
        {% elif group.grouper == 'D' %}
          <i class="bi bi-stars"></i>
        {% elif group.grouper == 'canceled' %}
          <i class="bi bi-x-octagon"></i>
        {% endif %}
      </div>
      <h3>{{ group.list|length }}</h3>
      <p>
        {% if group.grouper == 'P' %}–û–∂–∏–¥–∞—é—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è{% elif group.grouper == 'C' %}–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ{% elif group.grouper == 'D' %}–ó–∞–≤–µ—Ä—à–µ–Ω–æ{% elif group.grouper == 'canceled' %}–û—Ç–º–µ–Ω–µ–Ω–æ{% endif %}
      </p>
    </div>
    {% endfor %}
  </div>

  <div class="timeline">
    {% for appointment in appointments %}
    <article class="appointment-card">
      <header class="appointment-header">
        <div>
          <div class="salon-name">{{ appointment.stylist.user.get_full_name|default:appointment.stylist.user.username }}</div>
          <div class="text-muted small">{{ appointment.stylist_service.salon_service.salon.name }}</div>
        </div>
        <span class="status-chip {% if appointment.status == 'P' %}status-pending{% elif appointment.status == 'C' %}status-confirmed{% elif appointment.status == 'D' %}status-done{% elif appointment.status == 'canceled' %}status-canceled{% endif %}">
          {% if appointment.status == 'P' %}
            <i class="bi bi-hourglass-split"></i> –û–∂–∏–¥–∞–µ—Ç
          {% elif appointment.status == 'C' %}
            <i class="bi bi-check2-circle"></i> –ü—Ä–∏–Ω—è—Ç–æ
          {% elif appointment.status == 'D' %}
            <i class="bi bi-stars"></i> –í—ã–ø–æ–ª–Ω–µ–Ω–æ
          {% elif appointment.status == 'canceled' %}
            <i class="bi bi-x-octagon"></i> –û—Ç–º–µ–Ω–µ–Ω–æ
          {% endif %}
        </span>
      </header>

      <section>
        <h6 class="fw-semibold text-uppercase text-secondary mb-3">–£—Å–ª—É–≥–∏</h6>
        <ul class="services-list">
          {% for s in appointment.services.all %}
            <li>{{ s.stylist_service.salon_service.service.name }}</li>
          {% empty %}
            <li class="bg-light text-muted">–£—Å–ª—É–≥–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã</li>
          {% endfor %}
        </ul>
      </section>

      <footer class="appointment-footer">
        <div class="time-block">
          <span class="badge bg-dark-subtle text-dark rounded-pill px-3 py-2 fw-semibold">
            <i class="bi bi-clock-history me-1"></i> {{ appointment.start_time|date:"d E" }} –≤ {{ appointment.start_time|date:"H:i" }}
          </span>
          <span class="text-muted">{{ appointment.start_time|date:"l"|capfirst }}</span>
        </div>
        <div class="actions">
          {% if appointment.status == "P" or appointment.status == "C" %}
          <form method="post" action="{% url 'cancel_appointment' appointment.id %}" class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-outline-danger btn-sm px-4"
                    onclick="return confirm('–¢–æ—á–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å?')">
              –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å
            </button>
          </form>
          {% else %}
          <span class="text-muted fst-italic">–î–µ–π—Å—Ç–≤–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</span>
          {% endif %}
        </div>
      </footer>
    </article>
    {% endfor %}
  </div>
  {% else %}
  <div class="empty-state">
    <div class="display-5 mb-3">üå∏</div>
    <h3>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π</h3>
    <p class="mb-4">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∑–∞–ø–∏—Å—å –∏ –ø–æ–∑–≤–æ–ª—å—Ç–µ –Ω–∞—à–µ–π –∫–æ–º–∞–Ω–¥–µ –ø–æ–∑–∞–±–æ—Ç–∏—Ç—å—Å—è –æ –≤–∞—à–µ–º —Å—Ç–∏–ª–µ. –ú—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª–∏ –ª—É—á—à–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –≤–∞—Å.</p>
    <a href="{% url 'home' %}" class="btn btn-dark btn-lg rounded-pill px-5">–ù–∞–π—Ç–∏ —É—Å–ª—É–≥—É</a>
  </div>
  {% endif %}

  <div class="wellbeing-box mt-5">
    <div>
      <h4 class="fw-bold mb-3">–°–æ–≤–µ—Ç—ã –ø–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –∫ –≤–∏–∑–∏—Ç—É</h4>
      <p class="text-muted mb-3">–ß—Ç–æ–±—ã –∫–∞–∂–¥–∞—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –ø—Ä–æ—à–ª–∞ –∏–¥–µ–∞–ª—å–Ω–æ, –º—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª–∏ –¥–ª—è –≤–∞—Å –Ω–µ–±–æ–ª—å—à–æ–π —á–µ–∫-–ª–∏—Å—Ç.</p>
      <ul>
        <li><strong>–ó–∞ –¥–µ–Ω—å –¥–æ –∑–∞–ø–∏—Å–∏:</strong> —É—Ç–æ—á–Ω–∏—Ç–µ –∂–µ–ª–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –ø–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –ø—Ä–∏–º–µ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—Ç.</li>
        <li><strong>–ó–∞ 2 —á–∞—Å–∞:</strong> –ø–æ—Å—Ç–∞—Ä–∞–π—Ç–µ—Å—å –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏–ª—å–Ω—ã–µ —É–∫–ª–∞–¥–æ—á–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –∏ —Å–Ω–∏–º–∏—Ç–µ —É–∫—Ä–∞—à–µ–Ω–∏—è.</li>
        <li><strong>–ü–æ—Å–ª–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã:</strong> –¥–æ–±–∞–≤—å—Ç–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ, —á—Ç–æ–±—ã –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –≤–∏–∑–∏—Ç –≤–æ–≤—Ä–µ–º—è.</li>
      </ul>
    </div>
    <div class="text-center">
      <img src="{% static 'img/beauty-time.svg' %}" alt="Beauty time" class="img-fluid" style="max-width: 240px;">
    </div>
  </div>
</div>
{% endblock %}
